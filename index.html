<!doctype HTML>
<html>
    <head>
        <title>York CS PhD Timeline</title>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js" integrity="sha512-pBSlhNUvB+td6sjW1zmR6L7c7kVWR4octUPl4tfHmzO63424nxta8aLmficEcAAswQmRqTiToi63AazDurj/Sg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.0.0/umd/react.production.min.js" integrity="sha512-bom/WJB/C/RVkBpU7ic7qopGc/CSWjj1aZhZLykucHKCZuT9h881Uh8VdvEioA6L0vQ/Tsaw1uK2Pnj312c17g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.0.0/umd/react-dom.production.min.js" integrity="sha512-HBhuJNLkfYh0Z++tgfKYCstQZzgQmMbAfK4FvzxHrUYqfI+FRnXeBn1ZXu+1NSGWissxE2ipI+eKaoRbRV2W4Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.js" integrity="sha512-CwxrLIN0dww6lRc/oKeZiI9oGlOob2HPMU0Yu0g+P3/G1cuTii+tt0jpyEKhilfrV7D/zmvKiVPIHUDU6xbBxg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <style>
            body{
                background-color:#202020;
                color: #ffffff;
                font-family: sans-serif;
            }
            .year{
                display: grid;
                grid-template-columns: repeat(12, 1fr);
            }
            .month{
                border:0.2em solid #005000;
                background-color: #706060;
                border-left-style:none;
                border-right-style:none;
                text-align:center;
            }
            .month-first{
                border-left-style:solid;
                border-radius: 50vh 0 0 50vh;
            }
            .month-last{
                border-right-style:solid;
                border-radius: 0 50vh 50vh 0;
            }
            .month-event{
                border: 0.2em solid #444444;
                border-radius:0.5em;
                padding: 0.5em;
            }
            .month-done{
                border-color:#005000;
                background-color: #307f30;
            }
        </style>
    </head>
    <body>
        <h1>York CS PhD Milestones</h1>
        <div id="react_root">loading...</div>
        <script type="text/babel">

            class TLMonth extends React.Component {
                render() {
                    return (
                        <div className={
                        (()=>{
                            const is_first = this.props.moy == 1;
                            const is_last = this.props.moy == 12;
                            let c = ['month'];
                            if (is_first) {c.push('month-first');}
                            if (is_last) {c.push('month-last');}
                            if (this.props.done) {c.push('month-done')}
                            return c.join(' ');
                        })()
                     }>
                            {this.props.m}
                        </div>
                    );
                }
            }

            class TLSmallEvent extends React.Component {
                constructor(props) {
                    super(props);
                }

                render() {
                    return (
                        <div class={this.props.events.length > 0?'month-event':'month-noevent'} style={{gridCol: this.props.moy}}>
                            {this.props.events.map(ev=>
                                ev.name
                            )}
                        </div>
                    );
                }               
            }

            class TLEvent extends React.Component {
                render() {
                    const month = this.props.data.month[this.props.mode]||'?';
                    return (
                        <div>
                            <h2>{this.props.data.name}</h2>
                            <p>Requirements: {this.props.data.req}</p>
                            <p>Outcomes: {this.props.data.outcome}</p>
                            <p>{this.props.data.details}</p>
                        </div>
                    );
                }
            }

            class Timeline extends React.Component {
                constructor(props){
                    super(props);
                    const data = jsyaml.load(props.data);
                    
                    const max_month = this.get_max_month(data, this.props.default_mode);
                    
                    this.state = {
                        data,
                        max_month
                        ,mode:this.props.default_mode
                        ,start_month: 10
                        ,start_year: 2021
                        ,now_month: new Date().getMonth()
                        ,now_year: new Date().getFullYear()
                        ,selection: null
                    }
                }

                is_done(m){
                    const months_done = ((this.state.now_year*12)+this.state.now_month) - ((this.state.start_year * 12) + this.state.start_month) + 2;
                    console.log(this, "done", months_done, m);
                    return m <= months_done;
                }

                get_max_month(data, mode) {
                    const m = Math.max(...data.events.map(ev=>parseInt(ev.month[mode]||'0')));
                    return m;
                }

                render() {
                    return (
                        <div>
                            <h2>Timeline</h2>
                            <input type='checkbox' id='check_parttime' onChange={ev=>{
                                const mode = ev.target.checked?'pt':'ft';
                                this.setState({mode, max_month: this.get_max_month(this.state.data, mode) });
                            }} />
                            <label for='check_parttime'>Show Part-Time Milestones</label>
                            <br/>
                            <label for='start_month'>PhD Start Month</label>
                            <select id='start_month' onChange={ev=>{
                                const t = parseInt(ev.target.selectedOptions[0].value);
                                console.log(t);
                                this.setState({start_month: t});
                            }}>
                                <option value='1'>January</option>
                                <option value='2'>February</option>
                                <option value='3'>March</option>
                                <option value='4'>April</option>
                                <option value='5'>May</option>
                                <option value='6'>June</option>
                                <option value='7'>July</option>
                                <option value='8'>August</option>
                                <option value='9'>September</option>
                                <option value='10' selected>October</option>
                                <option value='11'>November</option>
                                <option value='12'>December</option>
                            </select>
                            <br/>
                            <label for='start_year'>PhD Start Year</label>
                            <input id='start_year' type='number' min='2018' max='2090' value={this.state.start_year} onChange={ev=>this.setState({start_year:ev.target.value})} />
                        
                            {
                                Array.from(Array(Math.ceil(this.state.max_month/12)).keys()).map(y=>
                                    <div key={'y'+y}>
                                        <h3>Year {y+1}</h3>
                                        <div class='year' key={'year-'+y} id={'year-'+y}>
                                            {Array.from(Array(12).keys()).map(i=>
                                                <TLMonth key={'m'+(i+1+(12*y))} y={y} m={i+1+(12*y)} moy={i+1} events={this.state.data.events.filter(ev=>ev.month[this.state.mode] == (i+1+(12*y)))} done={this.is_done(i+1+(12*y))} />
                                            )}
                                            {Array.from(Array(12).keys()).map(i=>
                                                <TLSmallEvent key={'e'+(i+1+(12*y))} y={y} m={i+1+(12*y)} moy={i+1} events={this.state.data.events.filter(ev=>ev.month[this.state.mode] == (i+1+(12*y)))} />
                                            )}
                                        </div>
                                    </div>
                                )
                            }
                            {
                            //    this.state.data.events.map(ev=>
                            //        <div><TLEvent data={ev} mode={this.state.mode} /></div>
                            //    )
                            }
                        </div>
                    );
                }
            }
            fetch("events.yaml").then(async resp => {
                if (resp.ok){
                    ReactDOM.render(<Timeline data={await resp.text()} default_mode='ft'/>, document.getElementById("react_root"));
                }
                else{
                    throw new Error("Error loading data");
                }
            })
            .catch(error=>{
                document.getElementById("react_root").innerText = error;
            })
        </script>
    </body>
</html>
